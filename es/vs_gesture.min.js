import{getElementAbsolutePosition,isFunction,vsTestElem}from"vs_utils";let GESTURE_START,GESTURE_CHANGE,GESTURE_END;const support={},events=["gesturestart","gesturechange","gestureend"];for(var el=document.createElement("div"),i=0;i<events.length;i++){var eventName=events[i],isSupported=(eventName="on"+eventName)in vsTestElem;isSupported||(vsTestElem.setAttribute(eventName,"return;"),isSupported="function"==typeof vsTestElem[eventName]),support[events[i]]=isSupported}support.gestures=support.gesturestart&&support.gesturechange&&support.gestureend,"MSGestureEvent"in window&&(support.msGestures=!0),support.gestures=!1,support.msGestures=!1;function getDistance(e,t){if(!e||!t)return 0;var n=t.pageX-e.pageX,r=t.pageY-e.pageY;return Math.sqrt(n*n+r*r)}function getAngle(e,t){return e&&t?180*Math.atan2(t.pageY-e.pageY,t.pageX-e.pageX)/Math.PI:0}var __init_centroid,__init_pos,__init_distance=0,__init_angle=0;function getCentroid(e){var t=e.length,n=0,r=0,i=0;if(0===t)return{X:0,y:0};for(;n<t;n++){var o=e[n];r+=o.pageX,i+=o.pageY}return{x:r/t-__init_pos.x,y:i/t-__init_pos.y}}function getTranslate(e,t){return[e.x-t.x,e.y-t.y]}var buildPaylaod=function(e,t){var n=t?void 0:getCentroid(e.targetPointerList);return{scale:t?void 0:getDistance(e.targetPointerList[0],e.targetPointerList[1])/__init_distance,rotation:t?void 0:getAngle(e.targetPointerList[0],e.targetPointerList[1])-__init_angle,translation:t?void 0:getTranslate(n,__init_centroid),nbPointers:e.nbPointers,pointerList:e.pointerList,targetPointerList:e.targetPointerList,centroid:n,changedPointerList:e.changedPointerList}},_gesture_follow=!1,gestureStartListener=function(e,t){if(!(e.targetPointerList.length<2))if(e.preventDefault(),_gesture_follow)createCustomEvent(GESTURE_CHANGE,e.target,buildPaylaod(e));else{__init_distance=getDistance(e.targetPointerList[0],e.targetPointerList[1]),__init_angle=getAngle(e.targetPointerList[0],e.targetPointerList[1]);e.targetPointerList[0].target._comp_;__init_pos=getElementAbsolutePosition(e.targetPointerList[0].target,!0),__init_centroid=getCentroid(e.targetPointerList),document.addEventListener(POINTER_MOVE,gestureChangeListener),document.addEventListener(POINTER_END,gestureEndListener),document.addEventListener(POINTER_CANCEL,gestureEndListener),createCustomEvent(GESTURE_START,e.target,buildPaylaod(e)),_gesture_follow=!0}},gestureChangeListener=function(e){e.preventDefault(),pointerMoveHandler(e,function(e){e.targetPointerList.length<2?(document.removeEventListener(POINTER_MOVE,gestureChangeListener),document.removeEventListener(POINTER_END,gestureEndListener),document.removeEventListener(POINTER_CANCEL,gestureEndListener),_gesture_follow=!1,createCustomEvent(GESTURE_END,e.target,buildPaylaod(e,!0))):createCustomEvent(GESTURE_CHANGE,e.target,buildPaylaod(e))})},gestureEndListener=function(e){e.preventDefault(),pointerEndHandler(e,function(e){e.targetPointerList.length<2?(document.removeEventListener(POINTER_MOVE,gestureChangeListener),document.removeEventListener(POINTER_END,gestureEndListener),document.removeEventListener(POINTER_CANCEL,gestureEndListener),_gesture_follow=!1,createCustomEvent(GESTURE_END,e.target,buildPaylaod(e,!0))):createCustomEvent(GESTURE_CHANGE,e.target,buildPaylaod(e))})};function buildGestureList(e){e.centroid={x:e.pageX,y:e.pageY},e.translation=getTranslate(e.centroid,__init_centroid),e.pointerList=[new Pointer(e,PointerTypes.TOUCH,MOUSE_ID)],e.targetPointerList=e.pointerList,e.nbPointers=1}var gestureIOSStartListener=function(e,t){__init_centroid={x:e.pageX,y:e.pageY},buildGestureList(e),t(e)},gestureIOSChangeListener=function(e,t){buildGestureList(e),t(e)},gestureIOSEndListener=function(e,t){buildGestureList(e),t(e)};support.msGestures?(GESTURE_START="MSGestureStart",GESTURE_CHANGE="MSGestureChange",GESTURE_END="MSGestureEnd"):support.gestures?(GESTURE_START="gesturestart",GESTURE_CHANGE="gesturechange",GESTURE_END="gestureend"):(GESTURE_START="_gesture_start",GESTURE_CHANGE="_gesture_change",GESTURE_END="_gesture_end");function touchToGestureListenerAdd(e,t,n,r){var i=r.listener?r.listener.id:void 0;switch(t){case GESTURE_START:return r.gesture_handler=function(e){pointerStartHandler(e,gestureStartListener,i)},e.addEventListener(POINTER_START,r.gesture_handler),r.handler=n,!0;case GESTURE_CHANGE:case GESTURE_END:return r.handler=n,!0}return!1}function gestureEventListenerAdd(e,t,n,r){var i=r.listener?r.listener.id:void 0;switch(t){case GESTURE_START:return r.handler=function(e){gestureIOSStartListener(e,n,i)},!0;case GESTURE_CHANGE:return r.handler=function(e){gestureIOSChangeListener(e,n,i)},!0;case GESTURE_END:return r.handler=function(e){gestureIOSEndListener(e,n,i)},!0}return!1}const manageGestureListenerAdd=support.gestures||support.msGestures?gestureEventListenerAdd:touchToGestureListenerAdd;function touchToGestureListenerRemove(e,t,n){var r=n.listener?n.listener.id:void 0;switch(t){case GESTURE_START:return e.removeEventListener(POINTER_START,n.gesture_handler,r),!0;case GESTURE_CHANGE:case GESTURE_END:return!0}return!1}function gestureListenerRemove(e,t,n){switch(t){case GESTURE_START:case GESTURE_CHANGE:case GESTURE_END:return!0}return!1}const manageGestureListenerRemove=support.gestures||support.msGestures?gestureListenerRemove:touchToGestureListenerRemove;var EVENT_SUPPORT_TOUCH=!1,hasPointer=window.navigator.pointerEnabled,hasMSPointer=window.navigator.msPointerEnabled;"undefined"!=typeof document&&"createTouch"in document?EVENT_SUPPORT_TOUCH=!0:hasPointer||hasMSPointer?EVENT_SUPPORT_TOUCH=!0:"undefined"!=typeof document&&window.navigator&&window.navigator.userAgent&&(-1===window.navigator.userAgent.indexOf("iPhone")&&-1===window.navigator.userAgent.indexOf("iPad")&&-1===window.navigator.userAgent.indexOf("Android")&&-1===window.navigator.userAgent.indexOf("BlackBerry")||(EVENT_SUPPORT_TOUCH=!0));var POINTER_START,POINTER_MOVE,POINTER_END,POINTER_CANCEL;EVENT_SUPPORT_TOUCH?(POINTER_START=hasPointer?"pointerdown":hasMSPointer?"MSPointerDown":"touchstart",POINTER_MOVE=hasPointer?"pointermove":hasMSPointer?"MSPointerMove":"touchmove",POINTER_END=hasPointer?"pointerup":hasMSPointer?"MSPointerUp":"touchend",POINTER_CANCEL=hasPointer?"pointercancel":hasMSPointer?"MSPointerCancel":"touchcancel"):(POINTER_START="mousedown",POINTER_MOVE="mousemove",POINTER_END="mouseup",POINTER_CANCEL=null);var MOUSE_ID$1=31337;class Pointer$1{constructor(e,t,n,r,i,o){this.configureWithEvent(e,r,i,o),this.type=t,this.identifier=n}configureWithEvent(e,t,n,r){this.pageX=e.pageX,this.pageY=e.pageY,"undefiend"!=typeof t&&(this.clientX=t),"undefiend"!=typeof n&&(this.clientY=n),e.target?this.target=e.target:r&&(this.target=r.target),e.currentTarget?this.currentTarget=e.currentTarget:r&&(this.currentTarget=r.currentTarget)}}var PointerTypes$1={TOUCH:2,PEN:3,MOUSE:4},pointerEvents=[];function buildTouchList(e,t){var n=[];e.nbPointers=e.touches.length;for(var r=0;r<e.nbPointers;r++){var i=e.touches[r],o=new Pointer$1(i,PointerTypes$1.TOUCH,i.identifier,i.clientX,i.clientY,e);n.push(o)}e.pointerList=n,n=[];for(r=0;r<e.targetTouches.length;r++){i=e.targetTouches[r];if(!t||pointerEvents[i.identifier]==t){o=new Pointer$1(i,PointerTypes$1.TOUCH,i.identifier,i.clientX,i.clientY,e);n.push(o)}}e.targetPointerList=n,n=[];for(r=0;r<e.changedTouches.length;r++){i=e.changedTouches[r],o=new Pointer$1(i,PointerTypes$1.TOUCH,i.identifier,e.clientX,e.clientY,e);n.push(o)}e.changedPointerList=n}function buildMouseList(e,t){var n=[];n.push(new Pointer$1(e,PointerTypes$1.MOUSE,MOUSE_ID$1,e.layerX,e.layerY)),t?(e.nbPointers=0,e.pointerList=[],e.targetPointerList=[],e.changedPointerList=n):(e.nbPointers=1,e.pointerList=n,e.targetPointerList=n,e.changedPointerList=[])}var all_pointers=[],removed_pointers=[];function buildMSPointerList(e,t,n){var r=[],i=[],o=[],s=e.pointerId,a=all_pointers[s];t?(a?(removed_pointers[s]=a,all_pointers[s]=void 0):(a=removed_pointers[s])||(a=new Pointer$1(e,e.pointerType,s,e.layerX,e.layerY),removed_pointers[s]=a),removed_pointers.forEach(function(e){e&&o.push(e)}),removed_pointers=[]):a?a.configureWithEvent(e):(a=new Pointer$1(e,e.pointerType,s,e.layerX,e.layerY),all_pointers[s]=a),all_pointers.forEach(function(e){e&&(r.push(e),n&&pointerEvents[e.identifier]!=n||i.push(e))}),e.nbPointers=r.length,e.pointerList=r,e.targetPointerList=i,e.changedPointerList=o}function mouseDownHandler(e,t){buildMouseList(e),t(e)}function mouseMoveHandler(e,t){buildMouseList(e),t(e)}function mouseUpHandler(e,t){buildMouseList(e,!0),t(e)}function touchStartHandler(e,t,n){for(var r,i=e.targetTouches.length,o=0;o<i;o++)r=e.targetTouches[o],pointerEvents[r.identifier]=n;buildTouchList(e),t(e)}function touchMoveHandler(e,t,n){buildTouchList(e,n),t(e)}function touchEndHandler(e,t){for(var n,r=e.changedTouches.length,i=0;i<r;i++)n=e.changedTouches[i],pointerEvents[n.identifier]=void 0;buildTouchList(e),t(e)}function touchCancelHandler(e,t){buildTouchList(e),t(e,t)}var nbPointerListener=0,msRemovePointer=function(e){var t=e.pointerId,n=all_pointers[t];n&&(removed_pointers[n.identifier]=n,all_pointers[n.identifier]=void 0),0===--nbPointerListener&&(document.removeEventListener(hasPointer?"pointerup":"MSPointerUp",msRemovePointer),document.removeEventListener(hasPointer?"pointercancel":"MSPointerCancel",msRemovePointer))};function msPointerDownHandler(e,t,n){pointerEvents[e.pointerId]=n,buildMSPointerList(e,!1,n),t(e),0===nbPointerListener&&(document.addEventListener(hasPointer?"pointerup":"MSPointerUp",msRemovePointer),document.addEventListener(hasPointer?"pointercancel":"MSPointerCancel",msRemovePointer)),nbPointerListener++}function msPointerMoveHandler(e,t,n){buildMSPointerList(e,!1,n),t(e)}function msPointerUpHandler(e,t){buildMSPointerList(e,!0),t(e)}function msPointerCancelHandler(e,t){buildMSPointerList(e,!0),t(e)}var pointerStartHandler,pointerMoveHandler,pointerEndHandler,pointerCancelHandler;EVENT_SUPPORT_TOUCH?hasMSPointer?(pointerStartHandler=msPointerDownHandler,pointerMoveHandler=msPointerMoveHandler,pointerEndHandler=msPointerUpHandler,pointerCancelHandler=msPointerCancelHandler):(pointerStartHandler=touchStartHandler,pointerMoveHandler=touchMoveHandler,pointerEndHandler=touchEndHandler,pointerCancelHandler=touchCancelHandler):(pointerStartHandler=mouseDownHandler,pointerMoveHandler=mouseMoveHandler,pointerEndHandler=mouseUpHandler,pointerCancelHandler=mouseUpHandler);function getBindingIndex(e,t,n){if(!t||!n||!n.__event_listeners)return-1;for(var r=0;r<n.__event_listeners.length;r++){var i=n.__event_listeners[r];if(i.target===e&&i.type===t&&i.listener===n)return r}return-1}function createUniqueId(){return""+(new Date).getTime()+Math.floor(1e6*Math.random())}function managePointerListenerAdd(e,t,n,r){var i=r.listener?r.listener.id:void 0;switch(i||(i=createUniqueId(),r.listener&&(r.listener.id=i)),t){case POINTER_START:return r.handler=function(e){pointerStartHandler(e,n,i)},!0;case POINTER_MOVE:return r.handler=function(e){pointerMoveHandler(e,n,i)},!0;case POINTER_END:return r.handler=function(e){pointerEndHandler(e,n)},!0;case POINTER_CANCEL:return r.handler=function(e){pointerCancelHandler(e,n)},!0}return!1}function managePointerListenerRemove(e,t,n){switch(t){case POINTER_START:case POINTER_MOVE:case POINTER_END:case POINTER_CANCEL:return!0}return!1}function addPointerListener(e,t,n,r){if(t)if(n){var i=n;if(isFunction(n)||(i=n.handleEvent,isFunction(i)&&(i=i.bind(n))),-1===getBindingIndex(e,t,n)){n.__event_listeners||(n.__event_listeners=[]);var o={target:e,type:t,listener:n};n.__event_listeners.push(o),managePointerListenerAdd(e,t,i,o)||manageGestureListenerAdd(e,t,i,o)||(o.handler=i),e.addEventListener(t,o.handler,r)}else console.error("addPointerListener binding already existing")}else console.error("addPointerListener no listener")}function removePointerListener(e,t,n,r){if(t)if(n){var i=getBindingIndex(e,t,n);if(-1!==i){var o=n.__event_listeners[i];n.__event_listeners.remove(i),managePointerListenerRemove(e,t,o)||manageGestureListenerRemove(e,t,o),e.removeEventListener(t,o.handler,r)}else console.error("removePointerListener no binding")}else console.error("removePointerListener no listener")}function createCustomEvent(e,t,n){var r=document.createEvent("Event");r.initEvent(e,!0,!0);for(var i in n)r[i]=n[i];t.dispatchEvent(r)}export{createCustomEvent,removePointerListener,addPointerListener,PointerTypes$1 as PointerTypes,Pointer$1 as Pointer,POINTER_START,POINTER_MOVE,POINTER_END,POINTER_CANCEL,manageGestureListenerRemove,manageGestureListenerAdd,GESTURE_START,GESTURE_CHANGE,GESTURE_END};